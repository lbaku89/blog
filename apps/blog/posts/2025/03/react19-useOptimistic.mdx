---
title: 'React 19 useOptimistic'
description: 'useOptimistic ì‚´í´ë³´ê¸°'
date: '2025-03-03'
tags: ['react19', 'react']
published: true
---

## ğŸ§©\`useOptimistic\`

\`useOptimistic\` ëŠ” ë‚™ê´€ì (optimistically)ìœ¼ë¡œ UIë¥¼ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” React Hook ì´ë‹¤.Â 

```jsx
const [optimisticState, addOptimistic] = useOptimistic(state, updateFn)
```

## ğŸ§©ë ˆí¼ëŸ°ìŠ¤

#### \`useOptimistic(state, updateFn)\`

\`useOptimistic\`ì€ aysnc action ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ stateë¥¼ ë³´ì—¬ì¤€ë‹¤. ì´ ë§ì„ ì˜ˆì‹œë¥¼ ë“¤ì–´ ì„¤ëª…í•˜ë©´ ì´ë ‡ë‹¤. ë§Œì•½ ìš°ë¦¬ê°€ ì¸ìŠ¤íƒ€ê·¸ë¨ì„ í•˜ë‹¤ê°€ ì¢‹ì•„ìš” ë²„íŠ¼ì„ í´ë¦­í•œë‹¤ê³  ê°€ì •í•˜ë©´ ìœ ì €ê°€ ê·¸ ê²Œì‹œë¬¼ì—ëŒ€í•´ ì¢‹ì•„ìš”ë¥¼ í–ˆë‹¤ëŠ” ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥í•˜ê¸° ìœ„í•´ì„œ ì„œë²„ì— http requestë¥¼ í•˜ê³  ì„œë²„ì—ì„œ í•´ë‹¹ ì‘ì—…ì„ ì™„ë£Œí•œ ë’¤ ì„œë²„ì—ì„œëŠ” response 200 codeë¥¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¤€ë‹¤. ë°©ê¸ˆë§í•œ ì¼ë ¨ì˜ ê³¼ì •ì´ ëë‚œ ë’¤ ì¢‹ì•„ìš” ë²„íŠ¼ì´ ëˆŒë¦°ìƒíƒœì˜ uië¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ë³´ë‹¨ ì´ ê³¼ì •ì„ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒ ì—†ì´ ì¦‰ì‹œ ì¢‹ì•„ìš” ë²„íŠ¼ì´ ëˆŒë¦¬ë„ë¡ ì²˜ë¦¬í•œë‹¤ëŠ” ì´ì•¼ê¸°ì´ë‹¤. ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```jsx
import { useOptimistic } from 'react'

function AppContainer() {
  const [optimisticState, addOptimistic] = useOptimistic(
    state,
    // updateFn
    (currentState, optimisticValue) => {
      // merge and return new state
      // with optimistic value
    }
  )
}
```

#### â•ë§¤ê°œë³€ìˆ˜

- state: ì‘ì—…ì´ ëŒ€ê¸° ì¤‘ì´ì§€ ì•Šì„ ì‹œ ì´ˆê¸°ì— ë°˜í™˜ë  ê°’ì´ë‹¤.
- updateFn(currentState, optimisticValue): í˜„ì¬ ìƒíƒœì™€ addOptimisticì— ì „ë‹¬ëœ ë‚™ê´€ì ì¸ ê°’ì„ ì´ìš©í•˜ëŠ” í•¨ìˆ˜ë¡œ, ê²°ê³¼ì ìœ¼ë¡œ ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ return í•œë‹¤.

#### â•ë°˜í™˜ê°’

- optimisticState: ê²°ê³¼ì ì¸ ë‚™ê´€ì ì¸ ìƒíƒœì´ë‹¤. ì‘ì—…ì´ ëŒ€ê¸° ì¤‘ì´ì§€ ì•Šì„ ë•ŒëŠ” stateì™€ ë™ì¼í•˜ë©°, ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° updateFnì—ì„œ ë°˜í™˜ë˜ëŠ” ê°’ê³¼ ë™ì¼í•˜ë‹¤. ( ì´ ë§ì€ ì¦‰ actionì´ ì§„í–‰ì¤‘ì¼ ë™ì•ˆë§Œ stateì™€ ë‹¤ë¥´ë‹¤ëŠ” ì´ì•¼ê¸°ì´ë‹¤.)Â 
- addOptimistic: addOptimisticëŠ” ë‚™ê´€ì ì¸ ì—…ë°ì´íŠ¸ê°€ ìˆì„ ë•Œ í˜¸ì¶œí•˜ëŠ” dispatch í•¨ìˆ˜ì´ë‹¤. ì–´ë– í•œ íƒ€ì…ì˜ optimisticValue ë¼ëŠ” í•˜ë‚˜ì˜ ì¸ìë¥¼ ì·¨í•˜ë©°, state ì™€ optimisticValueë¡œ updateFnì„ í˜¸ì¶œí•œë‹¤.

#### â•ì£¼ì˜ì‚¬í•­

- useOptimisticì˜ ë¦¬í„´ê°’ìœ¼ë¡œ ë‚˜ì˜¨ hookì€ transitionì´ë‚˜ form action ì•ˆì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ ( ì¤‘ìš” )
- useOptimisticì´ Optimistic valueë¥¼ ë²„ë¦¬ê³  ì‹¤ì œ stateê°’ìœ¼ë¡œ ë®ì–´ì“°ëŠ” ì‘ì—…ì€ form actionì´ë‚˜ transitionì´ ì¢…ë£Œëœ ì‹œì ì´ë‹¤. ê·¸ ì „ê¹Œì§€ëŠ” stateê°€ ì—…ë°ì´íŠ¸ ë˜ë©´ ì‹¤í–‰ëœ computeUpdatedStateë¥¼ ìƒˆë¡œìš´ stateë¡œ ê°€ì§€ê³  ëª¨ë‘ ì¬ì‹¤í–‰ëœë‹¤.

## ğŸ§©ì‚¬ìš©ë²•

í•˜ë‹¨ ì˜ˆì‹œëŠ” ê³µì‹í™ˆí˜ì´ì§€ì— ì˜¬ë¼ì˜¨ ì˜ˆì‹œì´ë‹¤. (ì‹¤ì œ ì½”ë“œì˜ ë™ì‘ì„ ë³´ê³ ì‹¶ìœ¼ë©´ [https://codesandbox.io/p/sandbox/tk7ks9](https://codesandbox.io/p/sandbox/tk7ks9) ë¥¼ ì°¸ê³ )

```jsx
import { useOptimistic, useState, useRef } from 'react'
import { deliverMessage } from './actions.js'

function Thread({ messages, sendMessage }) {
  const formRef = useRef()
  async function formAction(formData) {
    addOptimisticMessage(formData.get('message'))
    formRef.current.reset()
    await sendMessage(formData)
  }
  const [optimisticMessages, addOptimisticMessage] = useOptimistic(messages, (state, newMessage) => [
    ...state,
    {
      text: newMessage,
      sending: true,
    },
  ])

  return (
    <>
      {optimisticMessages.map((message, index) => (
        <div key={index}>
          {message.text}
          {!!message.sending && <small> (Sending...)</small>}
        </div>
      ))}
      <form action={formAction} ref={formRef}>
        <input type="text" name="message" placeholder="Hello!" />
        <button type="submit">Send</button>
      </form>
    </>
  )
}

export default function App() {
  const [messages, setMessages] = useState([{ text: 'Hello there!', sending: false, key: 1 }])
  async function sendMessage(formData) {
    const sentMessage = await deliverMessage(formData.get('message'))
    setMessages((messages) => [...messages, { text: sentMessage }])
  }
  return <Thread messages={messages} sendMessage={sendMessage} />
}
```

```jsx
export async function deliverMessage(message) {
  await new Promise((res) => setTimeout(res, 1000))
  return message
}
```

ìœ„ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ì´ ë™ì‘í•œë‹¤.Â 

<img src="react19-useOptimistic-1.webp" alt="Optimistic Example" />

- ì²«ë¡œë“œì‹œ í™”ë©´ì€ 1ë²ˆê³¼ ê°™ì´ ë³´ì—¬ì§„ë‹¤.
- inputì°½ì— 'ì…ë ¥ê°’' ì´ë¼ê³  ì…ë ¥í•˜ê³  send ë²„íŠ¼ í´ë¦­ ì‹œ formActionì´ ì´ë£¨ì–´ì§„ë‹¤. formActionì´ 1ì´ˆê°€ ë„˜ê²Œ ê±¸ë¦¬ë„ë¡ ë§Œë“¤ì—ˆì§€ë§Œ send ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°”ë¡œ í™”ë©´ì— ë°˜ì˜ëœë‹¤. ( ì…ë ¥ê°’(Sending ..) ). ì´ëŠ” optimisticMessageë¥¼ ì´ìš©í•˜ì—¬ í™”ë©´ì„ ë Œë”ë§í•˜ì˜€ê¸° ë•Œë¬¸ì´ë‹¤.Â 
- formActionë‚´ë¶€ \`await sendMessage(formData)\` ê°€ ì‹¤í–‰ë˜ê³  formActionì´ ëë‚˜ë©´ì„œÂ  optimisticMessage ì™€ stateëŠ” ê°’ì´ ì¼ì¹˜ëœë‹¤.Â 

## ğŸ§©ëŠë‚€ì 

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” ê°œë°œìê°€ ì‹¤ì œë¡œ stateë¥¼ ì´ìš©í•´ custom hookì„ ë§Œë“¤ê±°ë‚˜ react-queryë¥¼ ì´ìš©í•˜ëŠ” ë“± ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ë˜ì§€ í•´ì•¼ëì—ˆëŠ”ë° ì´ì œëŠ” ê·¸ëŸ´í•„ìš”ê°€ ì—†ì„ ê²ƒ ê°™ë‹¤. ì‹¤ì œë¡œ ì‚¬ìš©í•´ë³´ë‹ˆ ë§¤ìš° í¸ë¦¬í•˜ì˜€ë‹¤. ë³„ê°œë¡œ ê³µí™ˆì— ë‚˜ì˜¨ í˜ì´ì§€ë¥¼ ë‹¨ìˆœíˆ ì½ê¸°ë³´ë‹¨ ì´í•´í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì§ì ‘ ì½”ë“œë¡œ ë™ì‘êµ¬í˜„ì„ í†µí•´ ì´í•´í•˜ëŠ”ê²Œ ì‚¬ìš©ë²• ì´í•´ê°€ í›¨ì”¬ ì˜ ë  ê²ƒì´ë‹¤.Â 

## âœ…ì°¸ê³ 

- [https://react.dev/reference/react/useOptimistic](https://react.dev/reference/react/useOptimistic)
