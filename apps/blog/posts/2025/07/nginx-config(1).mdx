---
title: 'nginx config for frontend'
description: 'Nextjs assetPrefix, basePath ì„¤ì •'
date: '2025-07-26'
tags: ['nextjs', 'config']
published: false
---

{/* ê·¸ë•Œì˜ ìƒí™©ì„ ì ì–´ì„œ ë„£ê¸° */}

### ë°°ê²½

nextjs í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ì™€ì¤‘ì— ì‘ì—…ë¬¼ì„ ë°°í¬ë¥¼ í–ˆëŠ”ë° ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ í”„ë¡œì íŠ¸ ë‚´ë¶€ì—ì„œ ì„¤ì •ëœ assetPrefix ë¥¼ í™•ì¸í•˜ì˜€ê³  ë°°í¬í™˜ê²½ì—ì„œ assetPrefixê°€ `/nm/` ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì—ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ image ì»´í¬ë„ŒíŠ¸ì˜ ì´ë¯¸ì§€ë¡œë”ë¥¼ ì´ìš©í•˜ì—¬ ìš”ì²­ ê²½ë¡œë¥¼ ì˜ë„ì ìœ¼ë¡œ ë°”ê¾¸ì–´ í•´ê²°í–ˆì—ˆë‹¤.

## SSL ì¸ì¦ì„œ ê´€ë¦¬

SSL/TLS ì„¤ì •ì€ ë³´í†µ server ë¸”ë¡ ì•ˆì—ì„œ ì§„í–‰.

```nginx
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/example.crt;
    ssl_certificate_key /etc/nginx/ssl/example.key;
}
```

## í¬íŠ¸ ìˆ¨ê¹€(ë³´ì•ˆ)

```
location / {
    proxy_pass http://127.0.0.1:3000;
}
```

## ë¡œë“œë°¸ëŸ°ì‹±

nginxì˜ `upstream` ë¸”ë¡ì„ ì‚¬ìš©

```nginx
upstream app_servers {
    server 127.0.0.1:3000;
    server 127.0.0.1:3001;
}

server {
    location / {
        proxy_pass http://app_servers;
    }
}
```

## ì •ì  íŒŒì¼ ìºì‹±

```nginx
location /static/ {
    root /var/www;
    expires 30d;
    add_header Cache-Control "public";
}
```

## ì˜ˆì‹œ: í•œ ì„œë²„ì—ì„œ ì—¬ëŸ¬ ë„ë©”ì¸ ìš´ì˜

```nginx
# example.com
server {
    listen 80;
    server_name example.com www.example.com;

    root /var/www/example;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}

# test.com
server {
    listen 80;
    server_name test.com www.test.com;

    root /var/www/test;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

## ğŸ¤” ì™œ Nginxë¥¼ ì¨ì•¼ í• ê¹Œ?

í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë¼ë©´ ë³´í†µ `npm run dev`ë¡œ ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³ ,
`localhost:3000`ì—ì„œ ê°œë°œí•˜ëŠ” ê²ƒì— ìµìˆ™í•  ê²ƒì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ”:

- SSL ì¸ì¦ì„œ ê´€ë¦¬
- í¬íŠ¸ ìˆ¨ê¹€ (ë³´ì•ˆ)
- ë¡œë“œë°¸ëŸ°ì‹±
- ì •ì  íŒŒì¼ ìºì‹±

ë“±ì˜ ì´ìœ ë¡œ Nginxë¥¼ ì•ë‹¨ì— ë‘ê³  í”„ë¡ì‹œ ì„¤ì •ì„ í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ì€ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ Nginx ì„¤ì •ì„
í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ê´€ì ì—ì„œ í•˜ë‚˜ì”© ëœ¯ì–´ë³´ê² ìŠµë‹ˆë‹¤! ğŸ”§

## ğŸŒ ì „ì²´ ìš”ì²­ íë¦„

ì‚¬ìš©ì ìš”ì²­: example.com/nm/\_next/static/app.css â†“ Nginx (í¬íŠ¸ 80/443) â†“ URL ì¬ì‘ì„± localhost:3003/\_next/static/app.css (Next.js) â†“ ì‘ë‹µ Nginx â†’ ì‚¬ìš©ì

> ì¦‰, Nginxê°€ **ì¤‘ê°„ ë‹¤ë¦¬** ì—­í• ì„ í•´ì¤ë‹ˆë‹¤!

## ğŸ”§ ì„¤ì • íŒŒì¼ ëœ¯ì–´ë³´ê¸°

### 1ï¸âƒ£ ìš”ì²­ ë²”ìœ„ ì§€ì •

```nginx
location /nm/_next/ {
```

**ì˜ë¯¸**: URLì´ `/nm/\_next/`ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆ

**ì˜ˆì‹œ**

- âœ… `example.com/nm/_next/static/app.css`
- âœ… `example.com/nm/_next/image/logo.png`
- âŒ `example.com/hi/nm/_next/app.css` (ë§¤ì¹­ ì•ˆë¨)

### 2ï¸âƒ£ í¬íŠ¸ ì„¤ì •

```nginx
set $front_port 3003;
if ($port_front) {
set $front_port $port_front;
}
```

**ì˜ë¯¸**:

- ê¸°ë³¸ì ìœ¼ë¡œ í¬íŠ¸ 3003 ì‚¬ìš©
- í™˜ê²½ë³€ìˆ˜ `$port_front`ê°€ ìˆìœ¼ë©´ ê·¸ ê°’ ì‚¬ìš©
- JavaScriptë¡œ ì¹˜ë©´ `port = port || 3003`

### 3ï¸âƒ£ URL ì¬ì‘ì„± (í•µì‹¬!)

\```nginx
rewrite ^/nm/\_next/(.\*)$ /\_next/$1 break;
\```
**ì˜ë¯¸**: URL ê²½ë¡œ ë³€í™˜

- **ì…ë ¥**: `/nm/_next/static/app.css`
- **ì¶œë ¥**: `/_next/static/app.css`
- **ì •ê·œì‹**: `(.*)`ë¡œ ë’·ë¶€ë¶„ ìº¡ì²˜, `$1`ìœ¼ë¡œ ì¬ì‚¬ìš©

### 4ï¸âƒ£ í”„ë¡ì‹œ ì „ë‹¬

\```nginx
proxy_pass http://127.0.0.1:$front_port;
\```
**ì˜ë¯¸**: ë³€í™˜ëœ URLì„ `localhost:3003`ìœ¼ë¡œ ì „ë‹¬

### 5ï¸âƒ£ í—¤ë” ì„¤ì •

\```nginx
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
\```
**ì˜ë¯¸**:

- Next.js ì„œë²„ê°€ ì›ë³¸ ìš”ì²­ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ í—¤ë” ì „ë‹¬
- íŠ¹íˆ WebSocket (Hot Reload) ì§€ì›ì„ ìœ„í•œ ì„¤ì • í¬í•¨

## ğŸ’¼ ì‹¤ë¬´ì—ì„œëŠ” ì´ë ‡ê²Œ í™œìš©í•´ìš”

### ê°œë°œ í™˜ê²½

npm run dev â†’ localhost:3000 Nginx â†’ /nm/\_next/ ìš”ì²­ì„ localhost:3000ìœ¼ë¡œ í”„ë¡ì‹œ

### í”„ë¡œë•ì…˜ í™˜ê²½

### ì™œ `/nm/` í”„ë¦¬í”½ìŠ¤ë¥¼ ì“¸ê¹Œ?

- ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ í•œ ë„ë©”ì¸ì—ì„œ ì„œë¹™
- `example.com/nm/` â†’ Next.js ì•±
- `example.com/api/` â†’ API ì„œë²„
- `example.com/admin/` â†’ ê´€ë¦¬ì í˜ì´ì§€

npm run build && npm start â†’ localhost:3003 Nginx â†’ SSL, ìºì‹±, ë¡œë“œë°¸ëŸ°ì‹± + í”„ë¡ì‹œ

## ğŸš¨ ìì£¼ ë§Œë‚˜ëŠ” ë¬¸ì œë“¤

### 1. 404 ì—ëŸ¬

**ì›ì¸**: URL ë§¤ì¹­ì´ ì•ˆë¨  
**í•´ê²°**: `location` ê²½ë¡œ í™•ì¸

### 2. CSS/JS ë¡œë”© ì‹¤íŒ¨

**ì›ì¸**: `rewrite` ê·œì¹™ ì˜¤ë¥˜  
**í•´ê²°**: ì •ê·œì‹ê³¼ `$1` ë§¤í•‘ í™•ì¸

### 3. Hot Reload ì•ˆë¨

**ì›ì¸**: WebSocket í—¤ë” ëˆ„ë½  
**í•´ê²°**: `proxy_set_header Upgrade` ì„¤ì • í™•ì¸

## ğŸ¯ ì •ë¦¬

Nginx í”„ë¡ì‹œ ì„¤ì •ì˜ í•µì‹¬ì€:

1. **`location`**: ì–´ë–¤ ìš”ì²­ì„ ì²˜ë¦¬í• ì§€
2. **`rewrite`**: URLì„ ì–´ë–»ê²Œ ë³€í™˜í• ì§€
3. **`proxy_pass`**: ì–´ë””ë¡œ ì „ë‹¬í• ì§€
4. **í—¤ë”**: ì–´ë–¤ ì •ë³´ë¥¼ í•¨ê»˜ ë³´ë‚¼ì§€

í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë„ ì´ ì •ë„ë§Œ ì•Œë©´
ì„œë²„ ê°œë°œìì™€ ì†Œí†µí•  ë•Œ í›¨ì”¬ ìˆ˜ì›”í•´ì§‘ë‹ˆë‹¤! ğŸ˜Š

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” HTTPS ì„¤ì •ê³¼ ìºì‹± ì „ëµì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.

```text


        # ì •ì  ìì‚° í”„ë¡ì‹œ: /nm/_next â†’ /_next


        # ì—¬ê¸°ì„œ locationì€ nginxì˜ í•µì‹¬ ì§€ì‹œì–´ë¡œ /nm/_next/ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ì´ ë¸”ë¡ ì•ˆì˜ ê·œì¹™ì„ ì ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
        # domain.com/nm/_next/ë¡œ ì‹œì‘í•˜ëŠ” URLì— ëŒ€í•´ì„œë§Œ ì´ ë¸”ë¡ì´ ì ìš©ëœë‹¤. (domain.com/hi/nm/_next/ëŠ” ì ìš©ë˜ì§€ ì•ŠìŒ)
        location /nm/_next/ {
                # ê¸°ë³¸ í¬íŠ¸ë¥¼ 3003ìœ¼ë¡œ ì„¤ì • (Next.js ê°œë°œì„œë²„ í¬íŠ¸)
                # set $front_port 3003;ì€ Nginxì—ì„œ ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ê°’ì„ í• ë‹¹í•˜ëŠ” ë¬¸ë²•ì…ë‹ˆë‹¤.
                set $front_port 3003;

                # ë§Œì•½ $port_front ë³€ìˆ˜ê°€ ìˆìœ¼ë©´ ê·¸ ê°’ì„ ì‚¬ìš©
                if ($port_front) {
                        set $front_port $port_front;
                }

                # URL ì¬ì‘ì„±: /nm/_next/íŒŒì¼ëª… â†’ /_next/íŒŒì¼ëª… ìœ¼ë¡œ ë³€ê²½
                # ì˜ˆ: /nm/_next/static/css/app.css â†’ /_next/static/css/app.css
                rewrite ^/nm/_next/(.*)$ /_next/$1 break;


                # ë³€ê²½ëœ URLì„ localhost:3003ìœ¼ë¡œ ì „ë‹¬ (Next.js ì„œë²„)
                proxy_pass http://127.0.0.1:$front_port;

                # WebSocket ì§€ì›ì„ ìœ„í•œ í—¤ë” ì„¤ì • (Hot Reload ë“±)
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_http_version 1.1;

                # ì›ë³¸ ìš”ì²­ ì •ë³´ë¥¼ Next.jsì— ì „ë‹¬
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Cookie $http_cookie;
        }

        # /nm/ ìœ„ì¹˜ ì„¤ì •
        location /nm {
                # ë™ì¼í•˜ê²Œ í¬íŠ¸ 3003 ì„¤ì •
                set $front_port 3003;
                if ($port_front) {
                                set $front_port $port_front;
                }


                # /nmìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ìš”ì²­ì„ Next.js ì„œë²„ë¡œ ì „ë‹¬
                # $request_uriëŠ” ì „ì²´ URL ê²½ë¡œë¥¼ ê·¸ëŒ€ë¡œ ì „ë‹¬
                proxy_pass http://127.0.0.1:$front_port$request_uri;

                # ìœ„ì™€ ë™ì¼í•œ í—¤ë” ì„¤ì •ë“¤
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Cookie $http_cookie;
        }
```
