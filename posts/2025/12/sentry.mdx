---
title: 'Sentry'
description: 'Sentry를 이용한 런타임 에러 트래킹 및 모니터링'
date: '2025-12-14'
tags: ['sentry', 'logging']
published: true
---

## 배경

실제로 어떤 서비스를 운영하다 보면 런타임 에러가 발생할 수 있다.  
이런 에러를 트래킹하고 모니터링하는 것은 서비스의 안정성을 보장하기 위해 필수적이다.  
그래서 많은 회사들이 이슈 모니터링을 쓰고 있는데 요즘 Sentry를 많이 사용하고 있는 것 같아보이고 자세히 알아보고 싶어 정리하는 시간을 가지려고 한다.

## 설치법

https://docs.sentry.io/platforms/javascript/guides/nextjs/ 를 보면 알 수 있다. (nextjs 사용한다고 가정)

`npx @sentry/wizard@latest -i nextjs` 를 통해 깔기전에 아래와 같인 전제조건이 필요하다

- A Next.js application (nextjs 어플리케이션)
- A Sentry account and project (계정과 프로젝트 세팅)

## FEATURES

여러가지 기능에 대해 알아보자

### Capturing Errors

Sentry SDK를 설치하고 나면 우리 에플리케이션의 런타임 시 발생하는 에러는 자동으로 캡쳐되어 보고된다.  
즉, 에러를 캡쳐하는 별도의 코드가 필요없다는 이야기이다. 보고된 에러들은 우리 대시보드에서 확인 할 수 있다.

#### Capturing Errors

SDK를 어플리케이션에 설치해도 우리는 직접적으로 에러를 아래 코드처럼 직접 캡쳐하여 보고 할 수 있다.  
그리고 우리는 Error 객체 말고도 non-Error 객체나 string을 전달 할 수도 있다.
대신 당연한 이야기이지만 에러가 아닌 객체나 string을 전달하면 stack trace 정보는 누락된다.

```js
import * as Sentry from '@sentry/nextjs'
try {
  aFunctionThatMightFail()
} catch (err) {
  Sentry.captureException(err)
}
```

##### Capturing Errors in `error.js` Files

Next.js에는 `error.js` 라는 특별한 기능을 하는 파일이 있다.
이 파일은 프로젝트 내에서 예외가 발생하면 자동으로 호출되면서 fallback UI역할을 한다.  
이 파일은 에러 핸들링을 위해서 존재하며 Sentry가 하는 error 핸들링보다 더 우선순위를 갖는다.  
즉, error.js 에 의해 핸들링되는 error는 error.js 파일 내부에서 수동으로 에러를 capture해서 리포팅 해야한다.  
( 이 부분은 프로젝트 활용 시 주의해야 할 것 같다.)

```jsx
"use client";
import { useEffect } from "react";
import * as Sentry from "@sentry/nextjs";
export default function ErrorPage({
  error,
}: {
  error: Error & { digest?: string };
}) {
  useEffect(() => {
    // Log the error to Sentry
    Sentry.captureException(error);
  }, [error]);
  return (
    <div>
      <h2>Something went wrong!</h2>
    </div>
  );
}
```

#### Capturing Messages

아래와 같이 특정 메시지를 캡쳐하고 위험도를 설정하여 리포팅할 수 있다.  
위험도는 아래와 같이 설정할 수 있다.("fatal" | "error" | "warning" | "log" | "debug" | "info" (default))

```js
Sentry.captureMessage('Something went wrong')
// optionally specify the severity level:
// "fatal" | "error" | "warning" | "log" | "debug" | "info" (default)
Sentry.captureMessage('Something went wrong', 'warning')
```

### Source Maps

런타임시 발생하는 에러가 리포팅 되면 우리는 스택트레이스를 통해 에러가 발생된 코드를 확인할 수 있다.  
그런데 소스맵이 없다면 그 에러가 발생한 코드를 봐도 minified 되어 있기에 읽기가 불편하다.  
참고로 소스맵에는 번들 파일의 특정 줄/컬럼 `<->` 원본 파일 몇 번째 줄, 파일 경로, 변수/함수명 같은 정보들이 있기에 번들링 되기 전 소스를 파악할 수 있다.

`@sentry/nextjs` SDK를 설치하면 이런 소스맵은 자동으로 생성되기에 이런 불편함을 해소 할 수 있다.
참고로 소스 맵은 프로덕션 빌드 중에만 생성된다, 즉 `next build`에서만 생성되고, 개발빌드 (next dev) 에서는 업로드용 소스 맵이 생성되지 않는다고 한다.  
필자는 처음에 그런줄도 모르고 왜 Stack trace 정보가 minified 되어있어서 꽤 해메었다.

필자가 직접 테스트해본 결과 소스맵 생성에 있어서 auth token 설정이 필요해 보인다.
처음 sentry 설치시 `npx @sentry/wizard@latest -i nextjs` 를 통해 설치하면 자동으로 소스맵 생성을 위한 auth token 설정이 된다.(sentry 계정이 존재한다는 가정하에)

만약 auth token 을 발급받지 못했다면 센트리에 접속하여 로그인 하고 좌측패널 `Settings` -> `Developer Settings` -> `Organization Tokens` 에 접속해서 `Create New Token` 버튼을 클릭하여 생성할 수 있다.  
이렇게 생성된 생성된 auth token 을 환경변수에 넣어두고 아래와 같이 next.config.js 에 설정해주면 된다.

```js
// next.config.js
const { withSentryConfig } = require("@sentry/nextjs");
module.exports = withSentryConfig(
  {
    // your existing Next.js config
  },
  {
    ...
    authToken: process.env.SENTRY_AUTH_TOKEN,

  },
);
```

### Logs (!New)

### Session Replay

### Tracing

### Metrics (Beta)

### Profiling

### Crons

### User Feedback

### Feature Flags

##

## 에러 트래킹 vs 모니터링

에러 트래킹(Error Tracking)과 모니터링(Monitoring)은 비슷해 보이지만 다른 개념이다.

### 에러 트래킹 (Error Tracking)

- **목적**: 특정 에러가 발생했을 때 이를 추적하고 기록하는 것에 초점
- **범위**: 에러 발생 시점, 스택 트레이스, 사용자 컨텍스트 등 에러 자체에 대한 정보
- **예시**:
  - JavaScript 런타임 에러 발생 시 자동으로 캡처
  - 에러 발생 빈도 추적
  - 에러별 그룹핑 및 중복 제거

### 모니터링 (Monitoring)

- **목적**: 애플리케이션의 전반적인 상태를 지속적으로 관찰
- **범위**: 성능 메트릭, 리소스 사용량, API 응답 시간, 비즈니스 메트릭 등
- **예시**:
  - 서버 CPU/메모리 사용률
  - API 엔드포인트 응답 시간
  - 사용자 세션 추적
  - 트랜잭션 성능 분석

### 관계

에러 트래킹은 모니터링의 한 부분이다. 모니터링이 더 넓은 개념이며, 에러 트래킹은 그 중에서도 에러에 특화된 부분이다.

Sentry는 주로 **에러 트래킹** 도구로 알려져 있지만, 최근에는 Performance Monitoring 기능도 추가되어 전반적인 모니터링도 가능하다.

### 참고

- https://tech.kakaopay.com/post/frontend-sentry-monitoring/
- https://techblog.woowahan.com/21604/
- https://www.postype.com/@team/post/18407805
- https://engineering.linecorp.com/ko/blog/log-collection-system-sentry-on-premise
